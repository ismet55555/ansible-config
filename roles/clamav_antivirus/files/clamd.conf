##########################################################
# ClamAV Daemon (clamd) Configuration
#
# Resources:
#   - https://aaronbrighton.medium.com/installation-configuration-of-clamav-antivirus-on-ubuntu-18-04-a6416bab3b41
#   - https://linux.die.net/man/5/clamd.conf
#   - https://blog.clamav.net/2016/03/configuring-on-access-scanning-in-clamav.html
#
##########################################################

##########################################################
# On-Access Scanning (clamonacc) Configuration
##########################################################
# OnAccessPrevention: Enables on-access scanning.
OnAccessPrevention yes

# OnAccessMaxFileSize: Sets the maximum file size for on-access scanning.
OnAccessMaxFileSize 5M

# Paths to recursively and actively monitor
# NOTE: https://github.com/Cisco-Talos/clamav/issues/793#issuecomment-1400083219
# NOTE: DO NOT include /etc, it will freeze the system!
OnAccessIncludePath /home
OnAccessIncludePath /root
OnAccessIncludePath /mnt
OnAccessIncludePath /opt
OnAccessIncludePath /usr/bin
OnAccessIncludePath /usr/sbin
OnAccessIncludePath /usr/local/bin
OnAccessIncludePath /usr/local/sbin

# Usernames to exclude from on-access scannings to
OnAccessExcludeUname clamav
# OnAccessExcludeUname root

# Paths to exclude from on-access scanning
OnAccessExcludePath ^/root/quarantine
OnAccessExcludePath ^/proc
OnAccessExcludePath ^/sys
OnAccessExcludePath ^/run
OnAccessExcludePath ^/dev
OnAccessExcludePath ^/snap
OnAccessExcludePath ^/etc
OnAccessExcludePath ^/var/lib/rsyslog
OnAccessExcludePath ^/var/lib/lxcfs/cgroup
OnAccessExcludePath ^/tmp  # Excluded due to opotential Inode exhaustion issues


##########################################################
# Default Configuration
##########################################################
# Automatically Generated by clamav-daemon postinst
# To reconfigure clamd run #dpkg-reconfigure clamav-daemon
# Please read /usr/share/doc/clamav-daemon/README.Debian.gz for details

# LocalSocket: Sets the location of the socket file for communication.
# Critical for enabling local client applications to interact with clamd.
LocalSocket /var/run/clamav/clamd.ctl

# FixStaleSocket: Removes an existing socket file during startup, allowing clamd to create a new one.
FixStaleSocket yes

# LocalSocketGroup: Sets the group ownership for the local socket.
LocalSocketGroup clamav

# LocalSocketMode: Sets the permissions for the local socket.
LocalSocketMode 666

# User: Specifies the user for running clamd (non-root recommended).
# Running clamd as a non-root user limits potential damage if clamd is compromised.
# User clamav
User root

# ScanMail: Enables scanning of Mail files.
ScanMail no

# ScanArchive: Enables scanning of Archive files.
ScanArchive yes

# ArchiveBlockEncrypted: Blocks or allows encrypted archives.
ArchiveBlockEncrypted no

# MaxDirectoryRecursion: Sets limit for directory recursion.
# Prevents excessive resource usage in cases of very deep directory structures.
MaxDirectoryRecursion 15

# FollowDirectorySymlinks: Configures whether to follow directory symlinks.
FollowDirectorySymlinks no

# FollowFileSymlinks: Configures whether to follow file symlinks.
FollowFileSymlinks no

# ReadTimeout: Sets the timeout for reading data from a file.
# Prevents hang-ups on large or problematic files, ensuring efficient operation.
ReadTimeout 180

# MaxThreads: Sets the maximum number of threads running at the same time.
MaxThreads 12

# MaxConnectionQueueLength: Sets the maximum number of queued connections.
MaxConnectionQueueLength 15

# LogSyslog: Enables logging to syslog.
LogSyslog no

# LogRotate: Enables log rotation.
LogRotate yes

# LogFacility: Specifies the type of program generating a log message.
LogFacility LOG_LOCAL6

# LogFile: Specifies the log file location for clamd activity.
# This is crucial for monitoring the activity of the daemon, including any threats it detects and actions taken.
LogFile /var/log/clamav/clamd.log

# LogFileMaxSize: Sets the maximum size of the log file.
# Limits the size of the log file to prevent it from consuming too much disk space.
LogFileMaxSize 0

# LogClean: Logs clean files as well.
# Provides a more comprehensive view of all scanned files, useful for audit purposes.
LogClean no

# LogVerbose: Enables detailed logging for in-depth information.
# Useful for in-depth analysis, troubleshooting, and understanding the behavior of clamd.
LogVerbose no

# PreludeEnable: Enables sending of ClamAV detections to a prelude manager.
PreludeEnable no

# PreludeAnalyzerName: Sets the name for the prelude analyzer.
PreludeAnalyzerName ClamAV

# DatabaseDirectory: Sets the directory where the database is stored.
DatabaseDirectory /var/lib/clamav

# OfficialDatabaseOnly: Use only the official database.
OfficialDatabaseOnly no

# SelfCheck: Sets the time interval for the self-check process.
SelfCheck 3600

# Foreground: Runs clamd in the foreground, useful for debugging.
# Allows real-time monitoring of logs and errors for troubleshooting.
Foreground no

# Debug: Enables debug mode.
Debug no

# ScanPE: Enables scanning of Portable Executable files.
# Important for systems interacting with Windows files, as these are frequent targets for malware.
ScanPE yes

# MaxEmbeddedPE: Sets the maximum size of an embedded PE file.
MaxEmbeddedPE 10M

# ScanOLE2: Enables scanning of OLE2 formats, such as Microsoft Office documents.
ScanOLE2 yes

# ScanPDF: Enables scanning of PDF files.
ScanPDF yes

# ScanSWF: Enables scanning of SWF files (Adobe Flash).
ScanSWF yes

# ScanXMLDOCS: Enables scanning of XMLDOCS files.
ScanXMLDOCS yes

# ScanHWP3: Enables scanning of HWP3 files.
ScanHWP3 yes

# MaxScanSize: Sets the maximum size of a file to scan.
# Protects the system from overload due to extremely large files.
MaxScanSize 100M

# MaxFileSize: Sets the maximum size of a single file that will be scanned.
# Limits the size of individual files scanned to manage resource usage.
MaxFileSize 25M

# MaxRecursion: Sets the maximum recursion level.
# Limits the depth of scanning in nested structures like archives to prevent resource exhaustion.
MaxRecursion 16

# MaxFiles: Sets the maximum number of files to be scanned within an archive.
# Prevents scanning an excessive number of files in a single archive, which could be a strain on resources.
MaxFiles 10000

# MaxPartitions: Sets the maximum number of partitions to be scanned.
MaxPartitions 50

# MaxIconsPE: Sets the maximum number of icons in a PE file to be scanned.
MaxIconsPE 100

# PCREMatchLimit: Sets the PCRE match limit.
PCREMatchLimit 10000

# PCRERecMatchLimit: Sets the PCRE recursive match limit.
PCRERecMatchLimit 5000

# PCREMaxFileSize: Sets the maximum file size for PCRE scanning.
PCREMaxFileSize 25M

# ScanHTML: Enables scanning of HTML files.
ScanHTML yes

# MaxHTMLNormalize: Sets the maximum size for normalizing HTML files.
MaxHTMLNormalize 10M

# MaxHTMLNoTags: Sets the maximum size for HTML files with no tags.
MaxHTMLNoTags 2M

# MaxScriptNormalize: Sets the maximum size for normalizing script files.
MaxScriptNormalize 5M

# MaxZipTypeRcg: Sets the maximum size for recognizing zip file types.
MaxZipTypeRcg 1M

# AlgorithmicDetection: Enables algorithmic detection of unknown viruses.
AlgorithmicDetection yes

# ScanELF: Enables scanning of ELF executables.
# Crucial for detecting malware targeted at Linux systems.
ScanELF yes

# IdleTimeout: Sets the timeout for an idle clamd process.
IdleTimeout 30

# CrossFilesystems: Configures whether clamd should scan files and directories on other filesystems.
CrossFilesystems yes

# PhishingSignatures: Enables phishing signature detection.
PhishingSignatures yes

# PhishingScanURLs: Enables scanning of URLs for phishing.
PhishingScanURLs yes

# PhishingAlwaysBlockSSLMismatch: Blocks phishing attempts with SSL mismatches.
PhishingAlwaysBlockSSLMismatch no

# PhishingAlwaysBlockCloak: Blocks cloaked phishing attempts.
PhishingAlwaysBlockCloak no

# PartitionIntersection: Enables scanning of partition intersections.
PartitionIntersection no

# DetectPUA: Detects potentially unwanted applications.
# Helps in identifying applications that might be unwanted or risky, maintaining a clean system environment.
DetectPUA yes

# ExcludePath: Excludes specified paths from scanning.
# Useful for avoiding scanning of trusted or internal applications, or where scanning might disrupt operations.
ExcludePath ^/root/quarantine
ExcludePath ^/proc
ExcludePath ^/sys
ExcludePath ^/run
ExcludePath ^/dev
ExcludePath ^/snap
ExcludePath ^/var/lib/lxcfs/cgroup

# Bytecode: Enables bytecode signatures.
Bytecode yes

# BytecodeSecurity: Configures bytecode security.
BytecodeSecurity TrustSigned

# BytecodeTimeout: Sets the timeout for running bytecode signatures.
BytecodeTimeout 60000

# StreamMaxLength: Sets the maximum length of a stream to be scanned.
StreamMaxLength 25M

# LogFileUnlock: Unlocks the log file.
LogFileUnlock no

# LeaveTemporaryFiles: If set to yes, leaves temporary files on disk after scanning.
LeaveTemporaryFiles no

# ExitOnOOM: Configures clamd to exit on out-of-memory error.
ExitOnOOM no

# ScanPartialMessages: Enables scanning of partial messages.
ScanPartialMessages no

# HeuristicScanPrecedence: Enables heuristic scan precedence.
HeuristicScanPrecedence no

# StructuredDataDetection: Enables detection of structured data (credit card numbers, SSN).
StructuredDataDetection no

# CommandReadTimeout: Sets the timeout for reading commands sent to clamd.
CommandReadTimeout 30

# SendBufTimeout: Sets the timeout for sending buffers to clamd.
SendBufTimeout 200

# MaxQueue: Sets the maximum number of queued items.
MaxQueue 100

# ExtendedDetectionInfo: Provides extended information on detections.
ExtendedDetectionInfo yes

# OLE2BlockMacros: Blocks or allows macros in OLE2 files.
OLE2BlockMacros no

# AllowAllMatchScan: Allows scanning all matches for each scanned buffer.
AllowAllMatchScan yes

# ForceToDisk: Forces all files to be written to disk before scanning.
ForceToDisk no

# DisableCertCheck: Disables certificate check in HTTPS connections.
DisableCertCheck no

# DisableCache: Disables caching.
DisableCache no

# MaxScanTime: Sets the maximum scan time.
MaxScanTime 120000
